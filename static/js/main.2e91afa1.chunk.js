(this["webpackJsonpblog-manager"]=this["webpackJsonpblog-manager"]||[]).push([[0],{134:function(e,t,n){},138:function(e,t){},140:function(e,t){},154:function(e,t){},156:function(e,t){},184:function(e,t){},186:function(e,t){},187:function(e,t){},192:function(e,t){},194:function(e,t){},213:function(e,t){},225:function(e,t){},228:function(e,t){},249:function(e,t,n){},250:function(e,t,n){"use strict";n.r(t);var o=n(0),s=n(1),c=n.n(s),r=n(126),a=n.n(r),i=n(17),l=n(8),u=n(4),h=(n(134),n(127)),j=n.n(h),b=function(e){var t=Object(u.f)();return Object(o.jsx)("div",{className:"userFormContainer",children:Object(o.jsxs)("div",{className:"userForm",children:[Object(o.jsx)("h3",{children:"Log in"}),Object(o.jsxs)("form",{children:[Object(o.jsxs)("label",{children:[" Username:",Object(o.jsx)("input",{type:"text",name:"username",value:e.username,onChange:e.onChange})]}),Object(o.jsxs)("label",{children:[" Password:",Object(o.jsx)("input",{type:"password",name:"password",value:e.password,onChange:e.onChange})]}),Object(o.jsxs)("p",{children:["Don't have an account? ",Object(o.jsx)(l.b,{to:"/signup",children:"Sign Up"})]}),Object(o.jsx)("button",{type:"submit",onClick:function(n){n.preventDefault(),fetch("".concat("https://odin-blogapi.herokuapp.com","/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password})}).then((function(e){return e.json()})).then((function(e){console.log(e),200===e.status&&(localStorage.setItem("authToken",e.token),localStorage.setItem("currentUser",JSON.stringify(e.user)),t.push("/"))}))},children:"Log In"})]})]})})},d=function(e){var t=Object(u.f)();if(Object(s.useEffect)((function(){e.setTitle(""),e.setContent(""),e.setPublished(!1),e.setEditAuthor(""),fetch("".concat("https://odin-blogapi.herokuapp.com","/posts")).then((function(e){return e.json()})).then((function(t){if(console.log(t),localStorage.getItem("currentUser")){var n=JSON.parse(localStorage.getItem("currentUser")).username,o=t.post_list.filter((function(e){return e.author&&e.author.username===n}));e.setUserPosts(o)}})).catch((function(e){return console.error(e)}))}),[]),e.userPosts)var n=e.userPosts.map((function(e){return Object(o.jsxs)("div",{className:e.published?"preview":"preview unpublishedPost","data-post":JSON.stringify(e),"data-id":e._id,children:[Object(o.jsxs)("h2",{className:"postTitle",children:[e.title,Object(o.jsx)("span",{children:e.published?"":" (Unpublished)"})]}),Object(o.jsxs)("div",{className:"actions",children:[Object(o.jsx)("button",{className:e.published?"unpublish":"publish",onClick:c,children:e.published?"Unpublish":"Publish"}),Object(o.jsx)("button",{className:"delete",onClick:r,children:"Delete"}),Object(o.jsx)("button",{className:"edit",onClick:a,children:"Edit"})]}),Object(o.jsx)("div",{className:"content",children:Object(o.jsx)("p",{className:"postContent",children:e.content})})]},e._id)}));function c(e){var t=e.target.parentElement.parentElement,n=JSON.parse(t.getAttribute("data-post"));fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/").concat(n.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")},body:JSON.stringify({title:n.title,content:n.content,published:!n.published,author:n.author._id})}).then((function(e){return e.json()})).then((function(e){console.log(e),window.location.reload()})).catch((function(e){return console.error(e)}))}function r(e){var t=e.target.parentElement.parentElement.getAttribute("data-id");fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/").concat(t),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")}}).then((function(e){return e.json()})).then((function(e){console.log(e),window.location.reload()})).catch((function(e){return console.error(e)}))}function a(n){var o=n.target.parentElement.parentElement,s=JSON.parse(o.getAttribute("data-post"));console.log(s),e.setTitle(s.title),e.setContent(s.content),e.setPublished(s.published),e.setEditAuthor(s.author._id),t.push("/posts/"+s.id)}return e.checkExpiration(),localStorage.getItem("currentUser")?Object(o.jsxs)("div",{className:"homepage",children:[Object(o.jsx)("h1",{children:"Your Blog Posts"}),Object(o.jsx)(l.b,{to:"/posts",children:Object(o.jsx)("div",{className:"createPost",children:Object(o.jsx)("h2",{children:"Create a new Post"})})}),n]}):(t.push("/login"),Object(o.jsxs)("div",{children:[Object(o.jsx)(l.b,{to:"/login",children:"Login"}),"Welcome guest"]}))},p=function(e){var t=Object(u.f)();return Object(o.jsxs)("div",{className:"postForm",children:[Object(o.jsx)("h2",{children:"Creating New Post"}),Object(o.jsxs)("form",{children:[Object(o.jsxs)("label",{children:["Title",Object(o.jsx)("input",{type:"text",name:"title",className:"formTitle",value:e.title,onChange:e.onChange})]}),Object(o.jsxs)("label",{children:[" Post Content",Object(o.jsx)("textarea",{name:"content",value:e.content,onChange:e.onChange})]}),Object(o.jsxs)("label",{children:["Publish",Object(o.jsx)("input",{type:"checkbox",name:"published",value:e.published,checked:e.published,onChange:e.onChange})]}),Object(o.jsx)("button",{onClick:function(n){n.preventDefault(),e.checkExpiration(),localStorage.getItem("authToken")?fetch("".concat("https://odin-blogapi.herokuapp.com","/posts"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")},body:JSON.stringify({title:e.title,content:e.content,published:e.published})}).then((function(e){return e.json()})).then((function(e){console.log(e),t.push("/")})).catch((function(e){return console.error(e)})):t.push("./login")},type:"submit",children:"Submit"})]})]})},g=function(e){var t=Object(u.g)().id,n=Object(u.f)();return Object(o.jsxs)("div",{className:"postForm",children:[Object(o.jsxs)("h2",{children:["Editing ",e.title]}),Object(o.jsxs)("form",{children:[Object(o.jsxs)("label",{children:["Title:",Object(o.jsx)("input",{type:"text",name:"title",value:e.title,onChange:e.onChange})]}),Object(o.jsxs)("label",{children:[" Post Content:",Object(o.jsx)("textarea",{name:"content",value:e.content,onChange:e.onChange})]}),Object(o.jsxs)("label",{children:["Publish?",Object(o.jsx)("input",{type:"checkbox",name:"published",value:e.published,checked:e.published,onChange:e.onChange})]}),Object(o.jsx)("button",{onClick:function(o){o.preventDefault(),e.checkExpiration(),localStorage.getItem("authToken")?fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")},body:JSON.stringify({title:e.title,content:e.content,published:e.published,author:e.editAuthor})}).then((function(e){return e.json()})).then((function(e){console.log(e),n.push("/")})).catch((function(e){return console.error(e)})):n.push("./login")},type:"submit",children:"Submit"})]})]})},O=function(e){return localStorage.getItem("currentUser")?Object(o.jsxs)("header",{children:[Object(o.jsx)(l.b,{to:"/",children:"Blog Manager"}),Object(o.jsxs)("nav",{children:[Object(o.jsx)("a",{href:"https://lufere.dev/blog-API",children:"Blog Viewer"}),Object(o.jsxs)("p",{children:["Welcome ",Object(o.jsx)("span",{children:JSON.parse(localStorage.getItem("currentUser")).username})]}),Object(o.jsx)("button",{onClick:function(){localStorage.clear(),window.location.reload()},children:"Logout"})]})]}):Object(o.jsxs)("header",{children:[Object(o.jsx)(l.b,{to:"/",children:"Blog Manager"}),Object(o.jsxs)("nav",{children:[Object(o.jsx)("a",{href:"https://lufere.dev/blog-API",children:"Blog Viewer"}),Object(o.jsx)(l.b,{to:"/login",children:"Login"}),Object(o.jsx)(l.b,{to:"/signup",children:"Sign up"})]})]})},m=function(e){var t=Object(u.f)();return Object(o.jsx)("div",{className:"userFormContainer",children:Object(o.jsxs)("div",{className:"userForm",children:[Object(o.jsx)("h3",{children:"Sign up"}),Object(o.jsxs)("form",{children:[Object(o.jsxs)("label",{children:[" Username",Object(o.jsx)("input",{type:"text",name:"username",value:e.username,onChange:e.onChange})]}),Object(o.jsxs)("label",{children:[" Password",Object(o.jsx)("input",{type:"password",name:"password",value:e.password,onChange:e.onChange})]}),Object(o.jsxs)("p",{children:["Already have an account? ",Object(o.jsx)(l.b,{to:"/login",children:" Log In"})]}),Object(o.jsx)("button",{className:"signupSubmit",type:"submit",onClick:function(n){n.preventDefault(),fetch("".concat("https://odin-blogapi.herokuapp.com","/sign-up"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password,creator:!0})}).then((function(e){return e.json()})).then((function(n){if(400===n.status&&(console.log("info",n.errors),n.info&&n.info.message&&alert(n.info.message),n.errors&&n.errors.forEach((function(e){return alert(e.msg)})),e.setPassword("")),200===n.status){var o=n.token,s=n.user;console.log("user",n.user),localStorage.setItem("currentUser",JSON.stringify(s)),localStorage.setItem("authToken",o),e.setUsername(""),e.setPassword(""),t.push("/")}})).catch((function(e){return console.error(e)}))},children:"Sign up"})]})]})})};var f=function(){var e=Object(s.useState)(""),t=Object(i.a)(e,2),n=t[0],c=t[1],r=Object(s.useState)(""),a=Object(i.a)(r,2),h=a[0],f=a[1],x=Object(s.useState)(),S=Object(i.a)(x,2),C=S[0],v=S[1],k=Object(s.useState)(""),y=Object(i.a)(k,2),P=y[0],w=y[1],T=Object(s.useState)(""),N=Object(i.a)(T,2),E=N[0],I=N[1],U=Object(s.useState)(!1),A=Object(i.a)(U,2),J=A[0],B=A[1],D=Object(s.useState)(),L=Object(i.a)(D,2),F=L[0],_=L[1],z=Object(s.useState)(),M=Object(i.a)(z,2),R=M[0],V=M[1];function W(e){var t=e.target.name,n=e.target.value;"username"===t&&c(n),"password"===t&&f(n),"title"===t&&w(n),"content"===t&&I(n),"published"===t&&B(!J)}function X(){if(localStorage.getItem("authToken")){var e=!1,t=localStorage.getItem("authToken"),n=j.a.decode(t,{complete:!0}),o=new Date;n.payload.exp<o.getTime()/1e3&&(e=!0),e&&localStorage.clear(),console.log("EXPIRED ",e)}}return Object(s.useEffect)((function(){console.log("hi"),X()}),[]),Object(s.useEffect)((function(){return console.log("USER POSTS",F)}),[F]),Object(o.jsxs)(l.a,{children:[Object(o.jsx)(O,{checkExpiration:X}),Object(o.jsxs)(u.c,{children:[Object(o.jsx)(u.a,{exact:!0,path:"/",children:Object(o.jsx)(d,{currentUser:C,setCurrentUser:v,checkExpiration:X,userPosts:F,setUserPosts:_,title:P,setTitle:w,content:E,setContent:I,published:J,setPublished:B,setEditAuthor:V})}),Object(o.jsx)(u.a,{exact:!0,path:"/login",children:Object(o.jsx)(b,{username:n,password:h,onChange:W,currentUser:C,setCurrentUser:v})}),Object(o.jsx)(u.a,{exact:!0,path:"/signup",children:Object(o.jsx)(m,{username:n,setUsername:c,password:h,setPassword:f,onChange:W})}),Object(o.jsx)(u.a,{exact:!0,path:"/posts/",children:Object(o.jsx)(p,{title:P,setTitle:w,content:E,setContent:I,published:J,setPublished:B,onChange:W,checkExpiration:X})}),Object(o.jsx)(u.a,{exact:!0,path:"/posts/:id",children:Object(o.jsx)(g,{title:P,setTitle:w,content:E,setContent:I,published:J,setPublished:B,onChange:W,checkExpiration:X,editAuthor:R,setEditAuthor:V})})]})]})};n(249);a.a.render(Object(o.jsx)(c.a.StrictMode,{children:Object(o.jsx)(f,{})}),document.getElementById("root"))}},[[250,1,2]]]);
//# sourceMappingURL=main.2e91afa1.chunk.js.map