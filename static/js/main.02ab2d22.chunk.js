(this["webpackJsonpblog-manager"]=this["webpackJsonpblog-manager"]||[]).push([[0],{136:function(e,t,n){},140:function(e,t){},142:function(e,t){},156:function(e,t){},158:function(e,t){},186:function(e,t){},188:function(e,t){},189:function(e,t){},194:function(e,t){},196:function(e,t){},215:function(e,t){},227:function(e,t){},230:function(e,t){},251:function(e,t,n){},252:function(e,t,n){"use strict";n.r(t);var s=n(0),o=n(2),r=n.n(o),c=n(128),a=n.n(c),i=n(16),l=n(9),u=n(5),h=(n(136),n(129)),d=n.n(h),b=function(e){var t=Object(u.f)();return Object(o.useEffect)((function(){e.expired||e.setErrors(),e.reset()}),[]),Object(s.jsxs)("div",{className:"userFormContainer",children:[e.errors?Object(s.jsx)("div",{className:"errorBanner",children:e.errors}):null,Object(s.jsxs)("div",{className:"userForm",children:[Object(s.jsx)("h3",{children:"Log in"}),Object(s.jsxs)("form",{children:[Object(s.jsxs)("label",{children:[" Username:",Object(s.jsx)("input",{type:"text",name:"username",value:e.username,onChange:e.onChange})]}),Object(s.jsxs)("label",{children:[" Password:",Object(s.jsx)("input",{type:"password",name:"password",value:e.password,onChange:e.onChange})]}),Object(s.jsxs)("p",{children:["Don't have an account? ",Object(s.jsx)(l.b,{to:"/signup",children:"Sign Up"})]}),Object(s.jsx)("button",{type:"submit",onClick:function(n){return console.log(e.errors),n.preventDefault(),fetch("".concat("https://odin-blogapi.herokuapp.com","/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password})}).then((function(e){return e.json()})).then((function(n){console.log(n),200===n.status?(localStorage.setItem("authToken",n.token),localStorage.setItem("currentUser",JSON.stringify(n.user)),e.checkExpiration(),e.reset(),e.setErrors(),t.push("/")):400===n.status&&e.setErrors(n.info.message)})),function(){console.log("UNMOUNTED"),e.reset()}},children:"Log In"})]})]})]})},p=function(e){var t=Object(u.f)();function n(e){return(new DOMParser).parseFromString(e,"text/html").documentElement.textContent}if(Object(o.useEffect)((function(){e.setTitle(""),e.setContent(""),e.setPublished(!1),e.setEditAuthor(""),fetch("".concat("https://odin-blogapi.herokuapp.com","/posts")).then((function(e){return e.json()})).then((function(t){if(localStorage.getItem("currentUser")){var n=JSON.parse(localStorage.getItem("currentUser")).username,s=t.post_list.filter((function(e){return e.author&&e.author.username===n}));e.setUserPosts(s)}})).catch((function(e){return console.error(e)}))}),[]),e.userPosts)var r=e.userPosts.map((function(e){return Object(s.jsxs)("div",{className:e.published?"preview":"preview unpublishedPost","data-post":JSON.stringify(e),"data-id":e._id,children:[Object(s.jsxs)("h2",{className:"postTitle",children:[e.title,Object(s.jsx)("span",{children:e.published?"":" (Unpublished)"})]}),Object(s.jsxs)("div",{className:"actions",children:[Object(s.jsx)("button",{className:e.published?"unpublish":"publish",onClick:c,children:e.published?"Unpublish":"Publish"}),Object(s.jsx)("button",{className:"delete",onClick:a,children:"Delete"}),Object(s.jsx)("button",{className:"edit",onClick:i,children:"Edit"})]}),Object(s.jsx)("div",{className:"content",dangerouslySetInnerHTML:{__html:n(e.content)}})]},e._id)}));function c(s){var o=s.target.parentElement.parentElement,r=JSON.parse(o.getAttribute("data-post"));fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/").concat(r.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")},body:JSON.stringify({title:r.title,content:n(r.content),published:!r.published,author:r.author._id})}).then((function(e){return e.json()})).then((function(e){console.log(e),window.location.reload()})).catch((function(n){console.error(n),e.sessionExpired(),t.push("/login")}))}function a(n){var s=n.target.parentElement.parentElement.getAttribute("data-id");fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/").concat(s),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")}}).then((function(e){return e.json()})).then((function(e){console.log(e),window.location.reload()})).catch((function(n){console.error(n),e.sessionExpired(),t.push("/login")}))}function i(n){var s=n.target.parentElement.parentElement,o=JSON.parse(s.getAttribute("data-post"));e.checkExpiration()?(e.sessionExpired(),t.push("/login")):(e.setTitle(o.title),e.setContent(o.content),e.setPublished(o.published),e.setEditAuthor(o.author._id),t.push("/posts/"+o.id))}return localStorage.getItem("currentUser")?Object(s.jsxs)("div",{className:"homepage",children:[Object(s.jsxs)("h1",{children:["Blog Posts by ",JSON.parse(localStorage.getItem("currentUser")).username]}),Object(s.jsx)(l.b,{to:"/posts",children:Object(s.jsx)("div",{className:"createPost",children:Object(s.jsx)("h2",{children:"Create a new Post"})})}),r]}):(t.push("/login"),Object(s.jsxs)("div",{children:[Object(s.jsx)(l.b,{to:"/login",children:"Login"}),"Welcome guest"]}))},j=n(42),g=function(e){var t=Object(u.f)();return Object(s.jsxs)("div",{className:"postForm",children:[Object(s.jsx)("h2",{children:"Creating New Post"}),Object(s.jsxs)("form",{children:[Object(s.jsxs)("label",{children:["Title",Object(s.jsx)("input",{type:"text",name:"title",className:"formTitle",value:e.title,onChange:e.onChange})]}),Object(s.jsxs)("label",{children:[" Post Content",Object(s.jsx)(j.a,{className:"editor",textareaName:"myTextArea",apiKey:"iou7093g4pl6zn5mrc6fxwye33asheqmzogqvbiyn985qfef",value:e.content,onEditorChange:e.onChange,tagName:"textarea",init:{height:300,menubar:!1,plugins:["advlist autolink lists link image","charmap print preview anchor help","searchreplace visualblocks code","insertdatetime media table paste wordcount"],toolbar:"undo redo | formatselect | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | help"},onChange:function(t){console.log("Content was updated:",t.target.getContent()),e.setContent(t.target.getContent())}})]}),Object(s.jsxs)("label",{children:["Publish",Object(s.jsx)("input",{type:"checkbox",name:"published",value:e.published,checked:e.published,onChange:e.onChange})]}),Object(s.jsx)("button",{onClick:function(n){n.preventDefault(),e.checkExpiration(),localStorage.getItem("authToken")?fetch("".concat("https://odin-blogapi.herokuapp.com","/posts"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")},body:JSON.stringify({title:e.title,content:e.content,published:e.published})}).then((function(e){return e.json()})).then((function(e){console.log(e),t.push("/")})).catch((function(e){return console.error(e)})):t.push("./login")},type:"submit",children:"Submit"})]})]})},m=function(e){var t=Object(u.g)().id,n=Object(u.f)();return Object(o.useEffect)((function(){var t;console.log("INITIAL CONTENT",e.content),e.setContent((t=e.content,(new DOMParser).parseFromString(t,"text/html").documentElement.textContent))}),[]),Object(s.jsxs)("div",{className:"postForm",children:[Object(s.jsxs)("h2",{children:["Editing ",e.title]}),Object(s.jsxs)("form",{children:[Object(s.jsx)("div",{className:"return",onClick:function(){return n.push("/")}}),Object(s.jsxs)("label",{children:["Title",Object(s.jsx)("input",{type:"text",name:"title",className:"formTitle",value:e.title,onChange:e.onChange})]}),Object(s.jsxs)("label",{children:[" Post Content",Object(s.jsx)(j.a,{textareaName:"myTextArea",apiKey:"iou7093g4pl6zn5mrc6fxwye33asheqmzogqvbiyn985qfef",initialValue:e.content,onEditorChange:e.onChange,init:{height:300,menubar:!1,plugins:["advlist autolink lists link image","charmap print preview anchor help","searchreplace visualblocks code","insertdatetime media table paste wordcount"],toolbar:"undo redo | formatselect | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | help"}})]}),Object(s.jsxs)("label",{children:["Publish?",Object(s.jsx)("input",{type:"checkbox",name:"published",value:e.published,checked:e.published,onChange:e.onChange})]}),Object(s.jsx)("button",{onClick:function(s){s.preventDefault(),e.checkExpiration(),e.checkExpiration?n.push("./login"):fetch("".concat("https://odin-blogapi.herokuapp.com","/posts/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("authToken")},body:JSON.stringify({title:e.title,content:e.content,published:e.published,author:e.editAuthor})}).then((function(e){return e.json()})).then((function(e){console.log(e),n.push("/")})).catch((function(e){console.error(e),n.push("./login")}))},type:"submit",children:"Submit"})]})]})},O=r.a.createContext(),x=O.Provider,f=(O.Consumer,O),v=function(e){var t=Object(u.f)(),n=Object(o.useContext)(f);return n?Object(s.jsxs)("header",{children:[Object(s.jsx)(l.b,{to:"/",children:"Blog Manager"}),Object(s.jsxs)("nav",{children:[Object(s.jsx)("a",{href:"https://lufere.dev/blog-API",children:"Blog Viewer"}),Object(s.jsxs)("p",{children:["Welcome ",Object(s.jsx)("span",{children:n.username})]}),Object(s.jsx)("button",{onClick:function(){t.push("/login"),localStorage.clear(),e.logout()},children:"Logout"})]})]}):Object(s.jsxs)("header",{children:[Object(s.jsx)(l.b,{to:"/",children:"Blog Manager"}),Object(s.jsxs)("nav",{children:[Object(s.jsx)("a",{href:"https://lufere.dev/blog-API",children:"Blog Viewer"}),Object(s.jsx)(l.b,{to:"/login",children:"Login"}),Object(s.jsx)(l.b,{to:"/signup",children:"Sign up"})]})]})},C=function(e){var t=Object(u.f)();return Object(o.useEffect)((function(){e.setErrors(),e.reset()}),[]),Object(s.jsxs)("div",{className:"userFormContainer",children:[e.errors?Object(s.jsx)("div",{className:"errorBanner",children:e.errors}):null,Object(s.jsxs)("div",{className:"userForm",children:[Object(s.jsx)("h3",{children:"Sign up"}),Object(s.jsxs)("form",{children:[Object(s.jsxs)("label",{children:[" Username",Object(s.jsx)("input",{type:"text",name:"username",value:e.username,onChange:e.onChange})]}),Object(s.jsxs)("label",{children:[" Password",Object(s.jsx)("input",{type:"password",name:"password",value:e.password,onChange:e.onChange})]}),Object(s.jsxs)("p",{children:["Already have an account? ",Object(s.jsx)(l.b,{to:"/login",children:" Log In"})]}),Object(s.jsx)("button",{className:"signupSubmit",type:"submit",onClick:function(n){n.preventDefault(),fetch("".concat("https://odin-blogapi.herokuapp.com","/sign-up"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password,creator:!0})}).then((function(e){return e.json()})).then((function(n){if(400===n.status&&(e.setErrors(n.errors[0].msg),e.setPassword("")),200===n.status){var s=n.token,o=n.user;console.log("user",n.user),localStorage.setItem("currentUser",JSON.stringify(o)),localStorage.setItem("authToken",s),e.setUsername(""),e.setPassword(""),t.push("/")}})).catch((function(e){return console.error(e)}))},children:"Sign up"})]})]})]})};var S=function(){var e=Object(o.useState)(""),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(o.useState)(""),a=Object(i.a)(c,2),h=a[0],j=a[1],O=Object(o.useState)(null),f=Object(i.a)(O,2),S=f[0],E=f[1],k=Object(o.useState)(""),y=Object(i.a)(k,2),N=y[0],w=y[1],T=Object(o.useState)(""),P=Object(i.a)(T,2),I=P[0],U=P[1],A=Object(o.useState)(!0),J=Object(i.a)(A,2),B=J[0],D=J[1],L=Object(o.useState)(),z=Object(i.a)(L,2),F=z[0],M=z[1],_=Object(o.useState)(),q=Object(i.a)(_,2),V=q[0],K=q[1],W=Object(o.useState)(),H=Object(i.a)(W,2),G=H[0],Q=H[1],R=Object(o.useState)(!1),X=Object(i.a)(R,2),Y=X[0],Z=X[1];function $(e){var t,n;e.target?(t=e.target.name,n=e.target.value):(t="content",n=e),"username"===t&&r(n),"password"===t&&j(n),"title"===t&&w(n),"content"===t&&U(n),"published"===t&&D(!B)}function ee(){E(null)}function te(){r(""),j("")}function ne(){Q("Session Expired, Log in again"),Z(!0),ee(),localStorage.clear()}function se(){if(localStorage.getItem("authToken")){var e=!1,t=localStorage.getItem("authToken"),n=d.a.decode(t,{complete:!0}),s=new Date;n.payload.exp<s.getTime()/1e3&&(e=!0);var o=n.payload;return o.token=t,e?(localStorage.clear(),!0):(E(o),!1)}}return Object(o.useEffect)((function(){se()}),[]),Object(s.jsx)(x,{value:S,children:Object(s.jsxs)(l.a,{children:[Object(s.jsx)(v,{checkExpiration:se,logout:ee}),Object(s.jsxs)(u.c,{children:[Object(s.jsx)(u.a,{exact:!0,path:"/",children:Object(s.jsx)(p,{errors:G,setErrors:Q,setCurrentUser:E,checkExpiration:se,sessionExpired:ne,setExpired:Z,logout:ee,userPosts:F,setUserPosts:M,title:N,setTitle:w,content:I,setContent:U,published:B,setPublished:D,setEditAuthor:K})}),Object(s.jsx)(u.a,{exact:!0,path:"/login",children:Object(s.jsx)(b,{errors:G,setErrors:Q,expired:Y,username:n,password:h,reset:te,onChange:$,checkExpiration:se,setCurrentUser:E})}),Object(s.jsx)(u.a,{exact:!0,path:"/signup",children:Object(s.jsx)(C,{errors:G,setErrors:Q,reset:te,username:n,setUsername:r,password:h,setPassword:j,onChange:$})}),Object(s.jsx)(u.a,{exact:!0,path:"/posts/",children:Object(s.jsx)(g,{title:N,setTitle:w,content:I,setContent:U,published:B,setPublished:D,onChange:$,checkExpiration:se})}),Object(s.jsx)(u.a,{exact:!0,path:"/posts/:id",children:Object(s.jsx)(m,{title:N,setTitle:w,content:I,setContent:U,published:B,setPublished:D,onChange:$,checkExpiration:se,editAuthor:V,setEditAuthor:K,sessionExpired:ne})})]})]})})};n(251);a.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(S,{})}),document.getElementById("root"))}},[[252,1,2]]]);
//# sourceMappingURL=main.02ab2d22.chunk.js.map